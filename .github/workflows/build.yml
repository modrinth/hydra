# DO NOT EDIT THIS FILE! Edit /workflows/<name>.ncl and run cargo make build-ci intead.
---
env:
  CARGO_TERM_COLOR: always
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@2
      - uses: cachix/install-nix-action@v17
        with:
          extra_nix_config: "access-tokens = github.com=${{ secrets.GITHUB_TOKEN }}\ntrusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY=\nsubstituters = https://cache.nixos.org/"
      - name: Install Dependencies
        run: "nix profile install -L nixpkgs#gnutar nixpkgs#pbzip2"
      - name: Build Hydra
        run: nix build -L  && tar -c -Ipbzip2 -f hydra.tar.bz2 ./result
      - name: Build Image
        run: "nix build -L .#docker-image && cp result hydra-docker.tar.gz"
      - name: Publish Artifacts
        uses: actions/upload-artifact@v3
        with:
          path: "hydra.tar.bz2\nhydra-docker.tar.gz"
name: Build
"on":
  pull_request: {}
  push:
    branches:
      - master
